<!--signup.html-->
<!DOCTYPE html>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<head>
    <meta charset="UTF-8">
</head>
<style>
    input {
        max-width: 500px;
    }

    .container {
        margin: 0 auto;
        width: 500px;
    }

    h1 {
        text-align: center;
    }

    .sub_button {
        display: flex;
        justify-content: center;
    }

    span {
        color: #ff0000;
    }

    h2 {
        font-size: 12px;
    }
</style>

<body>
    <form method="post" id="frm">
        <div class="container">
            <h1>회원가입</h1>
            <div class="form-group">
                <label for="loginId">아이디</label>
                <input type="text" class="form-control" id="loginId" name="loginId" placeholder="영문 소문자 + 숫자 (5~20자)"
                    maxlength="20">
                <span class="id_chk1" id="id_chk1" style="display: none;">필수 항목입니다.</span>
                <span class="id_chk2" id="id_chk2" style="display: none;">아이디는 5~20자이고, 영문 소문자와 숫자만 사용가능합니다.</span>
                <span class="id_chk3" id="id_chk3" style="display: none;">이미 존재하는 아이디 입니다.</span>
            </div>
            <div class="form-group">
                <label for="password">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password"
                    placeholder="영문 + 숫자 + 특수문자(8~16자)" maxlength="16">
                <span class="pw_chk1" id="pw_chk1" style="display: none;">필수 항목입니다.</span>
                <span class="pw_chk2" id="pw_chk2" style="display: none;">비밀번호는 영문 대 소문자, 숫자, 특수문자를 모두 사용한 8~16자만
                    가능합니다.</span>
            </div>
            <div class="form-group">
                <label for="more_password">비밀번호 재확인</label>
                <input type="password" class="form-control" id="more_password" name="more_password" maxlength="16">
                <span class="pw_more_chk1" id="pw_more_chk1" style="display: none;">필수 항목입니다.</span>
                <span class="pw_more_chk2" id="pw_more_chk2" style="display: none;">비밀번호가 일치하지 않습니다</span>
            </div>
            <div class="form-group">
                <label for="nickname">닉네임</label>
                <input type="text" class="form-control" id="nickname" name="nickname" maxlength="20">
                <span class="nick_chk1" id="nick_chk1" style="display: none;">필수 항목입니다.</span>
                <span class="nick_chk2" id="nick_chk2" style="display: none;">한글, 영어 대소문자, 숫자만 사용할 수 있습니다(20자 제한)</span>
                <span class="nick_chk3" id="nick_chk3" style="display: none;">이미 존재하는 닉네임 입니다.</span>
            </div>
            <div class="form-group">
                <label for="email">이메일</label>
                <input type="text" class="form-control" id="email" name="email">
                <!-- <input type="text" name="email" th:value="${userDto.email}" placeholder="이메일을 입력해주세요."> -->
                <span th:text="${valid_email}"></span>
                <span class="email_chk1" id="email_chk1" style="display: none;">필수 항목입니다.</span>
                <span class="email_chk2" id="email_chk2" style="display: none;">이메일 형식이 잘못되었습니다</span>
            </div>
            <!-- <div class="form-group">
                <label for="address">주소</label>
                <input type="text" class="form-control" id="address" name="address" value="00">
                <span class="addr_chk1" id="addr_chk1" style="display: none;">필수 항목입니다.</span>
            </div> -->
            <!-- <div class="form-group">
                <label for="profile">사용자 프로필(소개)</label>
                <input type="text" class="form-control" id="profile" name="profile" placeholder="본인을 소개하는 글을 간단하게 적어주세요"
                    value="00">
            </div> -->

            <div class="form-group">
                <h3>현재 반려동물을 기르고 계신가요?</h3>
                <input type="radio" name="petYN" value="Y" onclick="check_YN()" />네
                <input type="radio" name="petYN" value="N" onclick="check_YN()" />아니요
                <span class="petYN_chk1" id="petYN_chk1" style="display: none;">필수 항목입니다.</span>
            </div>

            <div class="add_info" id="add_info" style="display: none;">
                <div class="form-group">
                    <label for="petName">펫 이름</label>
                    <input type="text" class="form-control" id="petName" name="petName">
                    <span class="petName_chk1" id="petName_chk1" style="display: none;">필수 항목입니다.</span>
                    <span class="petName_chk2" id="petName_chk2" style="display: none;">한글, 영어만 사용 가능합니다.</span>
                </div>
                <div class="form-group">
                    <label for="petCategory">펫 종류</label>
                    <div>
                        <input type="radio" name="petCategory" value="dog" onclick="check_myPet()" /> 강아지
                        <input type="radio" name="petCategory" value="cat" onclick="check_myPet()" /> 고양이
                        <input type="radio" name="petCategory" value="animal" onclick="check_myPet()" /> 일반 동물
                    </div>
                    <span class="petCategory_chk1" id="petCategory_chk1" style="display: none;">필수 항목입니다.</span>
                </div>
            </div>

            <div class="form-group">
                <label for="wantPet">추천받길 원하는 펫 (최소 1가지 ~ 최대 3가지) </label>
                <div>
                    <input type="checkbox" name="wantPet" id="dog" value="dog" />강아지
                    <input type="checkbox" name="wantPet" id="cat" value="cat" /> 고양이
                    <input type="checkbox" name="wantPet" id="animal" value="animal" />일반 동물
                </div>
                <span class="want_pet_chk1" id="want_pet_chk1" style="display: none;">필수 항목입니다.</span>
            </div>

            <div class="sub_button">
                <button type="button" class="btn btn-primary" onclick="lastCheck()">가입 완료</button>
            </div>
        </div>
    </form>
</body>
<script type="text/javascript">

    var idCheck = false;
    var pwCheck = false;
    var pwMoreCheck = false;
    var nickCheck = false;
    var emailCheck = false;
    var addrCheck = false;
    var petYNCheck = false;
    var petYNValue = "N";
    var petNameCheck = false;
    var petCategoryCheck = false;
    var wantPetCheck = false;

    jQuery(document).ready(function () {

        // 아이디 검증
        $("#loginId").on("focusout",
            function () {
                var reg = /^[a-zA-Z0-9]{5,20}$/ //
                var id = $("#loginId").val();
                if (id == "") {
                    $("#id_chk1").css({
                        "display": "block"
                    });
                    $("#id_chk2").css({
                        "display": "none"
                    });
                    idCheck = false;
                }
                else if (reg.test(id) == false || id.includes(' ')) {
                    $("#id_chk2").css({
                        "display": "block"
                    });
                    $("#id_chk1").css({
                        "display": "none"
                    });
                    idCheck = false;
                }
                else {
                    // 아이디 중복인지 확인하는 로직
                    $.ajax({
                        url: '/member/idCheck',
                        type: 'post',
                        // dataType:'json',
                        data: {
                            "LOGIN_ID": id
                        },
                        success: function (r) {
                            if (r == "success") {
                                // alert("아이디 중복확인 완료");
                                $("#id_chk1").css({
                                    "display": "none"
                                });
                                $("#id_chk2").css({
                                    "display": "none"
                                });
                                $("#id_chk3").css({
                                    "display": "none"
                                });
                                idCheck = true;
                            }
                            else {
                                // alert("중복확인 실패");
                                $("#id_chk3").css({
                                    "display": "block"
                                });
                            }
                        }
                    });
                }
            });

        // 비밀번호
        $("#password").on("focusout",
            function () {
                // 2.비밀번호 확인 검사
                // 숫자/문자/특수문자/ 포함 형태의 8~16자리 이내의 암호 정규식 
                // 전체길이검사 /^.{8,16}$/
                // 숫자하나 반드시 포함 /\d/ 
                // 영문자 반드시 포함 /[a-zA-Z]/
                // 특수문자 반드시 포함  /[\*!&]/			
                var regPw = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,16}$/;
                var pw = $("#password").val();
                if (pw == "") {
                    $("#pw_chk1").css({
                        "display": "block"
                    });
                    $("#pw_chk2").css({
                        "display": "none"
                    });
                    pwCheck = false;
                }
                else if (regPw.test(pw) == false || pw.includes(' ')) {
                    $("#pw_chk2").css({
                        "display": "block"
                    });
                    $("#pw_chk1").css({
                        "display": "none"
                    });
                    pwCheck = false;
                }
                else {
                    // 줄일수 있는 방법 알아보기
                    $("#pw_chk1").css({
                        "display": "none"
                    });
                    $("#pw_chk2").css({
                        "display": "none"
                    });
                    pwCheck = true;
                }
            });

        // 비밀번호 재확인
        $("#more_password").on("focusout",
            function () {
                var morePw = $("#more_password").val();
                if (morePw == "") {
                    $("#pw_more_chk1").css({
                        "display": "block"
                    });
                    $("#pw_more_chk2").css({
                        "display": "none"
                    });
                    pwMoreCheck = false;
                }
                else if (morePw != $("#password").val()) {
                    $("#pw_more_chk2").css({
                        "display": "block"
                    });
                    $("#pw_more_chk1").css({
                        "display": "none"
                    });
                    pwMoreCheck = false;
                }
                else {
                    $("#pw_more_chk1").css({
                        "display": "none"
                    });
                    $("#pw_more_chk2").css({
                        "display": "none"
                    });
                    pwMoreCheck = true;
                }
            });

        // 닉네임
        $("#nickname").on("focusout",
            function () {
                var nickname = $("#nickname").val();
                var nickReg = /^[ㄱ-ㅎ|ㅏ-ㅣ|가-힣|a-z|A-Z|0-9|]+$/;
                if (nickname == "") {
                    $("#nick_chk1").css({
                        "display": "block"
                    });
                    $("#nick_chk2").css({
                        "display": "none"
                    });
                    nickCheck = false;
                }
                else if (nickReg.test(nickname) == false || nickname.includes(' ')) {
                    $("#nick_chk2").css({
                        "display": "block"
                    });
                    $("#nick_chk1").css({
                        "display": "none"
                    });
                    nickCheck = false;
                }
                else {
                    // 닉네임 중복인지 확인하는 로직
                    $.ajax({
                        url: '/member/nickCheck',
                        type: 'post',
                        data: {
                            "nickname": nickname
                        },
                        success: function (r) {
                            if (r == "success") {
                                alert("닉네임 중복확인 완료");
                                $("#nick_chk1").css({
                                    "display": "none"
                                });
                                $("#nick_chk2").css({
                                    "display": "none"
                                });
                                $("#nick_chk3").css({
                                    "display": "none"
                                });
                                nickCheck = true;
                            }
                            else {
                                alert("중복확인 실패");
                                $("#nick_chk3").css({
                                    "display": "block"
                                });
                            }
                        }
                    });
                }
            });

        // 이메일
        $("#email").on("focusout",
            function () {
                var email = $("#email").val();
                var emailReg = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
                if (email == "") {
                    $("#email_chk1").css({
                        "display": "block"
                    });
                    $("#email_chk2").css({
                        "display": "none"
                    });
                    emailCheck = false;
                }
                else if (emailReg.test(email) == false || email.includes(' ')) {
                    $("#email_chk2").css({
                        "display": "block"
                    });
                    $("#email_chk1").css({
                        "display": "none"
                    });
                    emailCheck = false;
                }
                else {
                    $("#email_chk1").css({
                        "display": "none"
                    });
                    $("#email_chk2").css({
                        "display": "none"
                    });
                    emailCheck = true;
                }
            });

        // 주소
        // $("#address").on("focusout",
        //     function () {
        //         var address = $("#address").val();
        //         if (address == "") {
        //             $("#addr_chk1").css({
        //                 "display": "block"
        //             });
        //             addrCheck = false;
        //         }
        //         else {
        //             // 주소 찾기 api 추가
        //             // 주소 찾은 이후에 수정 할 수 없게 추가
        //             $("#addr_chk1").css({
        //                 "display": "none"
        //             });
        //             addrCheck = true;
        //         }
        //     });

        // 펫 이름
        $("#petName").on("focusout",
            function () {
                var petName = $("#petName").val();
                var nameReg = /^[가-힣|a-z|A-Z|]+$/;
                if (petName == "") {
                    $("#petName_chk1").css({
                        "display": "block"
                    });
                    $("#petName_chk2").css({
                        "display": "none"
                    });
                    petNameCheck = false;
                }
                else if (nameReg.test(petName) == false) {
                    $("#petName_chk2").css({
                        "display": "block"
                    });
                    $("#petName_chk1").css({
                        "display": "none"
                    });
                    petNameCheck = false;
                }
                else {
                    $("#petName_chk1").css({
                        "display": "none"
                    });
                    $("#petName_chk2").css({
                        "display": "none"
                    });
                    petNameCheck = true;
                }
            });
    });

    // 반려동물 유무
    function check_YN() {
        var yn = $("input[type=radio][name=petYN]:checked").val();
        if (yn == "Y") {
            $("#add_info").css({
                "display": "block"
            });
            petYNValue = "Y";
        }
        else {
            $("#add_info").css({
                "display": "none"
            });
            petYNValue = "N";
        }
        petYNCheck = true;
        $("#petYN_chk1").css({
            "display": "none"
        });
    }

    // 반려동물 종류
    function check_myPet() {
        var dog = $("input[type=radio][name=petCategory]:checked");
        if (dog.length < 1) {
            $("#petCategory_chk1").css({
                "display": "block"
            });
        }
        else {
            $("#petCategory_chk1").css({
                "display": "none"
            });
        }
        petCategoryCheck = true;
    }

    // 추천받길 원하는 펫
    $("input[type=checkbox][name=wantPet]").change(function () {
        var checkList = $("input[type=checkbox][name=wantPet]:checked");
        if ($(this).is(':checked')) {
            if (checkList.length > 3) {
                alert("최대 3개까지만 선택이 가능합니다.");
                $(this).prop("checked", false);
            }
            else {
                $("input:checkbox[name=wantPet]:checked").each(function () {
                    var checkVal = $(this).val(); // 체크된 값의 value값 가져오기
                    console.log(checkVal);
                    $("input:checkbox[name='wantPetAll']").prop("checked", false);
                });
            }
            wantPetCheck = true;
            $("#want_pet_chk1").css({
                "display": "none"
            });
        }
        if (checkList.length < 1 && $("input[type=checkbox][name=wantPet]:checked").length < 1) {
            $("#want_pet_chk1").css({
                "display": "block"
            });
        }
    });

    function lastCheck() {
        if (petYNValue == "Y") {
            // if (idCheck == false || pwCheck == false || pwMoreCheck == false || nickCheck == false
            //     || emailCheck == false || /*addrCheck == false ||*/ petYNCheck == false || petNameCheck == false
            //     || petCategoryCheck == false || wantPetCheck == false) {
            //     if (idCheck == false) {
            //         $("#id_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (pwCheck == false) {
            //         $("#pw_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (pwMoreCheck == false) {
            //         $("#pw_more_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (nickCheck == false) {
            //         $("#nick_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (emailCheck == false) {
            //         $("#petName_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (petYNCheck == false) {
            //         $("#petYN_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (petNameCheck == false) {
            //         $("#petName_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (petCategoryCheck == false) {
            //         $("#petCategory_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (wantPetCheck == false) {
            //         $("#want_pet_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     alert("잘못입력된 항목이 있습니다. 다시 확인해주세요");
            //     return;
            // }
            // else {
                // var id = $("#loginId").val();
                // var formData = new FormData($("#frm")[0]);
                var form = $("#frm").serialize();
                $.ajax({
                    url: '/signup/check',
                    type: 'post',
                    // data: 
                    // {"loginId" : id}
                    // ,
                    dataType:'json',
                    data: form,
                    success: function (r) {
                        if (r.fail !=null) {
                            alert("잘못 입력된 항목이 있습니다. 다시 확인해주세요");
                        }
                        else {
                            $("#frm").attr("action", "/signup/success");
                            $("#frm").submit();
                        }
                    }
                });
            // }
        }
        else {
            // if (idCheck == false || pwCheck == false || pwMoreCheck == false || nickCheck == false
            //     || emailCheck == false || /*addrCheck == false ||*/ wantPetCheck == false) {
            //     if (idCheck == false) {
            //         $("#id_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (pwCheck == false) {
            //         $("#pw_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (pwMoreCheck == false) {
            //         $("#pw_more_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (nickCheck == false) {
            //         $("#nick_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (emailCheck == false) {
            //         $("#petName_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (petYNCheck == false) {
            //         $("#petYN_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     if (wantPetCheck == false) {
            //         $("#want_pet_chk1").css({
            //             "display": "block"
            //         });
            //     }
            //     alert("잘못입력된 항목이 있습니다. 다시 확인해주세요");
            //     return;
            // }
            // else {
                // var id = $("#loginId").val();
                // var formData = new FormData($("#frm")[0]);
                var form = $("#frm").serialize();
                $.ajax({
                    url: '/signup/check',
                    type: 'post',
                    // data: 
                    // {"loginId" : id}
                    // ,
                    dataType:'json',
                    data: form,
                    success: function (r) {
                        if (r.fail !=null) {
                            alert("잘못 입력된 항목이 있습니다. 다시 확인해주세요");
                        }
                        else {
                            $("#frm").attr("action", "/signup/success");
                            $("#frm").submit();
                        }
                    }
                });
            // }
        }
    }

</script>

</html>